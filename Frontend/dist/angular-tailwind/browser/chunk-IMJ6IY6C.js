import{s as k}from"./chunk-R62AQPLH.js";import{$a as x,Da as h,Ha as d,J as C,K as c,M as E,Sa as n,Sb as F,Ta as o,Tb as T,Yb as H,_a as D,bc as W,ec as j,h as M,k as S,lb as a,lc as b,mb as R,nb as m,pa as s,t as y,ta as I,ya as _,za as u}from"./chunk-O6JE7VC5.js";import"./chunk-EQDQRRRY.js";var N={production:!0,apiUrl:"https://api.openweathermap.org/data/2.5/weather?lat={lat}&lon={lon}&appid={API key}",tokenExpiryMinutes:60,refreshTokenExpiryDays:7,openWeatherApiKey:"e907793019854b8433397a2f82d86a0e"};var A=(()=>{class t{constructor(e){this.http=e,this.apiKey=N.openWeatherApiKey,this.apiUrl="https://api.openweathermap.org/data/2.5/weather"}fetchWeather(e,i){let r=`${this.apiUrl}?lat=${e}&lon=${i}&units=metric&appid=${this.apiKey}`;return this.http.get(r).pipe(S(l=>{let w=l?.rain?.["1h"]??l?.rain?.["3h"]??0,g=l?.main?.temp??0,O=this.estimateSunlightHours(l),K=this.estimateSoilMoisture();return{rainfall:w,temperature:g,sunlightHours:O,soilMoisture:K}}),y(l=>(console.error("Error fetching weather data:",l),M({rainfall:0,temperature:0,sunlightHours:0,soilMoisture:0}))))}estimateSunlightHours(e){let i=e?.sys?.sunrise,r=e?.sys?.sunset;if(!i||!r)return 0;let l=new Date(i*1e3),g=(new Date(r*1e3).getTime()-l.getTime())/(1e3*60*60);return Math.round(g*10)/10}estimateSoilMoisture(){return Math.round(Math.random()*1e3)/10}static{this.\u0275fac=function(i){return new(i||t)(E(W))}}static{this.\u0275prov=C({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function U(t,p){if(t&1&&(n(0,"li"),a(1),o()),t&2){let e=p.$implicit;s(),R(e)}}function B(t,p){if(t&1&&(n(0,"div",19)(1,"h3",20),a(2,"Alerts"),o(),n(3,"ul",21),h(4,U,2,1,"li",22),o()()),t&2){let e=x();s(4),d("ngForOf",e.alerts)}}function G(t,p){if(t&1&&(n(0,"li")(1,"strong"),a(2),o(),a(3),o()),t&2){let e=p.$implicit;s(2),m("",e.crop,":"),s(),m(" ",e.reason," ")}}function P(t,p){if(t&1&&(n(0,"div",23)(1,"h3",24),a(2,"Crop Recommendations"),o(),n(3,"ul",25),h(4,G,4,2,"li",22),o()()),t&2){let e=x();s(4),d("ngForOf",e.cropRecommendations)}}var f=(()=>{class t{constructor(e){this.weatherService=e,this.weatherData={rainfall:0,temperature:0,sunlightHours:0,soilMoisture:0},this.alerts=[],this.cropRecommendations=[],this.latitude=6.9271,this.longitude=79.8612,this.loading=!1}ngOnInit(){this.fetchWeather()}fetchWeather(){this.loading=!0,this.weatherService.fetchWeather(this.latitude,this.longitude).subscribe(e=>{console.log("Raw weather data received:",e),this.weatherData=e,this.evaluateAlerts(),this.generateCropRecommendations(),this.loading=!1})}evaluateAlerts(){this.alerts=[],this.weatherData.rainfall>50?this.alerts.push("Excessive Rainfall detected!"):this.weatherData.rainfall<5&&this.alerts.push("Low Rainfall detected!"),this.weatherData.soilMoisture<30&&this.alerts.push("Low Soil Moisture.")}generateCropRecommendations(){this.cropRecommendations=[];let{rainfall:e,temperature:i,sunlightHours:r,soilMoisture:l}=this.weatherData;e>40&&i>=20&&i<=30&&l>=40&&this.cropRecommendations.push({crop:"Tea",reason:"Ideal conditions for Tea cultivation."}),i>30&&r>7&&l>50&&this.cropRecommendations.push({crop:"Chili",reason:"Hot and sunny weather supports Chili growth."}),l<20&&this.cropRecommendations.push({crop:"Millet",reason:"Low soil moisture suitable for drought-resistant crops."}),this.cropRecommendations.length===0&&this.cropRecommendations.push({crop:"General crops",reason:"Monitor conditions closely for suitable crops."})}static{this.\u0275fac=function(i){return new(i||t)(I(A))}}static{this.\u0275cmp=_({type:t,selectors:[["app-smart-monitoring"]],decls:29,vars:8,consts:[[1,"text-foreground","font-semibold","mb-4","mt-4"],[1,"p-8","bg-white","rounded-2xl","mt-10","max-w-7xl","mx-auto"],[1,"flex","justify-end"],[1,"bg-primary","text-primary-foreground","flex-none","rounded-md","px-4","py-2.5","text-xs","font-semibold","cursor-pointer",3,"click","disabled"],[1,"grid","grid-cols-1","sm:grid-cols-2","md:grid-cols-4","gap-6","mt-10"],[1,"bg-blue-50","p-5","rounded-xl","shadow","border","border-blue-200"],[1,"text-sm","font-medium","text-blue-700"],[1,"text-2xl","font-bold","text-blue-900","mt-1"],[1,"bg-yellow-50","p-5","rounded-xl","shadow","border","border-yellow-200"],[1,"text-sm","font-medium","text-yellow-700"],[1,"text-2xl","font-bold","text-yellow-900","mt-1"],[1,"bg-orange-50","p-5","rounded-xl","shadow","border","border-orange-200"],[1,"text-sm","font-medium","text-orange-700"],[1,"text-2xl","font-bold","text-orange-900","mt-1"],[1,"bg-green-50","p-5","rounded-xl","shadow","border","border-green-200"],[1,"text-sm","font-medium","text-green-700"],[1,"text-2xl","font-bold","text-green-900","mt-1"],["class","mt-10 bg-red-50 border border-red-300 p-6 rounded-xl shadow",4,"ngIf"],["class","mt-10 bg-green-50 border border-green-300 p-6 rounded-xl shadow",4,"ngIf"],[1,"mt-10","bg-red-50","border","border-red-300","p-6","rounded-xl","shadow"],[1,"text-xl","font-semibold","text-red-700","mb-3"],[1,"list-disc","list-inside","text-red-800","space-y-1"],[4,"ngFor","ngForOf"],[1,"mt-10","bg-green-50","border","border-green-300","p-6","rounded-xl","shadow"],[1,"text-xl","font-semibold","text-green-700","mb-3"],[1,"list-disc","list-inside","text-green-800","space-y-2"]],template:function(i,r){i&1&&(n(0,"h3",0),a(1,"Smart Monitoring Dashboard"),o(),n(2,"div",1)(3,"div",2)(4,"button",3),D("click",function(){return r.fetchWeather()}),a(5),o()(),n(6,"div",4)(7,"div",5)(8,"p",6),a(9,"Rainfall"),o(),n(10,"p",7),a(11),o()(),n(12,"div",8)(13,"p",9),a(14,"Temperature"),o(),n(15,"p",10),a(16),o()(),n(17,"div",11)(18,"p",12),a(19,"Sunlight Hours"),o(),n(20,"p",13),a(21),o()(),n(22,"div",14)(23,"p",15),a(24,"Soil Moisture"),o(),n(25,"p",16),a(26),o()()(),h(27,B,5,1,"div",17)(28,P,5,1,"div",18),o()),i&2&&(s(4),d("disabled",r.loading),s(),m(" ",r.loading?"Fetching Weather...":"Fetch Latest Weather"," "),s(6),m(" ",r.weatherData.rainfall>0?r.weatherData.rainfall.toFixed(2)+" mm":"No Rainfall"," "),s(5),m(" ",r.weatherData.temperature.toFixed(1)," \xB0C "),s(5),m(" ",r.weatherData.sunlightHours.toFixed(1)," "),s(5),m(" ",r.weatherData.soilMoisture.toFixed(1)," % "),s(),d("ngIf",r.alerts.length>0),s(),d("ngIf",r.cropRecommendations.length>0))},dependencies:[H,F,T,k,j],encapsulation:2})}}return t})();var q=[{path:"",component:f}],$=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=u({type:t})}static{this.\u0275inj=c({imports:[b.forChild(q),b]})}}return t})();var lt=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275mod=u({type:t})}static{this.\u0275inj=c({imports:[$,f]})}}return t})();export{lt as SmartMonitoringModule};
